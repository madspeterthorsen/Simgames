---
import Layout from "../layouts/Layout.astro";

interface Game {
  id: number;
  title: string;
  img: string;
  description?: string;
}

export async function getStaticPaths() {
  const SUPABASE_URL = "https://wxjylkvjfnoijclnsffw.supabase.co";
  const SUPABASE_KEY = "sb_secret_jAuh8XhtJtcsYsH5yPDOYw_igg62J3R";

  const res = await fetch(`${SUPABASE_URL}/rest/v1/games?select=*`, {
    headers: {
      apikey: SUPABASE_KEY,
      Authorization: `Bearer ${SUPABASE_KEY}`,
    },
  });

  const games: Game[] = await res.json();

  return games.map((game) => ({
    params: { id: String(game.id) },
    props: { game },
  }));
}

const { game } = Astro.props as { game: Game & { description?: string } };

const fullDescription = game.description || "";
const firstDotIndex = fullDescription.indexOf(".");

let intro = fullDescription;
let body = "";

if (firstDotIndex !== -1) {
  intro = fullDescription.slice(0, firstDotIndex + 1).trim();
  body = fullDescription.slice(firstDotIndex + 1).trim();
}
---

<Layout>
  <style>
    :root {
      --accent: #00eaff;
    }

    main {
      max-width: 960px;
      margin: 0 auto;
      padding: 8rem 1.5rem 6rem 1.5rem;
      box-sizing: border-box;
    }

    .hero {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
      gap: 2.5rem;
      align-items: center;
      margin-bottom: 3.5rem;
    }

    .hero-text h1 {
      margin: 0 0 0.75rem 0;
      font-size: 2.4rem;
      letter-spacing: 2px;
    }

    .hero-text p.label {
      margin: 0 0 0.4rem 0;
      text-transform: uppercase;
      font-size: 0.8rem;
      letter-spacing: 0.18em;
      opacity: 0.75;
    }

    .hero-text p.intro {
      margin: 0;
      font-size: 1.05rem;
      line-height: 1.7;
    }

    .hero-image-wrapper {
      border-radius: 18px;
      overflow: hidden;
      background: rgba(0, 0, 0, 0.35);
      box-shadow: 0 0 35px rgba(0, 0, 0, 0.5);
      padding: 10px;
      margin-left: 7rem;
      margin-top: 4rem;
    }

    .hero-image-wrapper img {
      width: 100%;
      height: 100%;
      display: block;
      border-radius: 12px;
      object-fit: cover;
    }

    .content-box {
      background: rgba(0, 0, 0, 0.35);
      border-radius: 20px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      padding: 1.75rem 1.8rem 2.2rem 1.8rem;
      line-height: 1.8;
      font-size: 1rem;
      margin-bottom: 2.5rem;
      white-space: pre-line;
    }

    .cta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 0.5rem;
    }

    .btn {
      padding: 0.7rem 1.9rem;
      border-radius: 999px;
      border: 2px solid var(--accent);
      background: transparent;
      color: var(--accent);
      text-decoration: none;
      font-size: 0.95rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition:
        background-color 0.18s ease,
        color 0.18s ease,
        transform 0.18s ease,
        box-shadow 0.18s ease;
    }

    .btn.primary {
      background: var(--accent);
      color: #02040a;
      box-shadow: 0 0 20px rgba(0, 234, 255, 0.4);
      border-color: transparent;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 26px rgba(0, 234, 255, 0.55);
    }

    .book-btn {
      display: flex;
      justify-content: flex-start;
      margin-top: 1.75rem;
    }

    .book-btn img {
      width: 180px;
      height: auto;
      cursor: pointer;
      transition: transform 0.25s ease;
      image-rendering: pixelated;
    }

    .book-btn img:hover {
      content: url("/bookhover.png");
      transform: scale(1.02);
    }

    .book-btn {
      display: flex;
      justify-content: center;
      margin-top: 1rem;
    }

    .book-btn img {
      width: 150px;
    }

    @media (max-width: 820px) {
      main {
        padding-top: 6.5rem;
        padding-bottom: 4.5rem;
      }

      .hero {
        grid-template-columns: 1fr;
        gap: 1.8rem;
      }

      .hero-text h1 {
        font-size: 2rem;
      }

      .hero-image-wrapper {
        max-width: 360px;
        margin: 0 auto;
      }

      .content-box {
        padding: 1.4rem 1.3rem 1.8rem 1.3rem;
      }

      .cta-row {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>

  <main>
    <section class="hero">
      <div class="hero-text">
        <p class="label">Simgame</p>
        <h1>{game.title}</h1>
        {intro && <p class="intro">{intro}</p>}
      </div>

      {
        game.img && (
          <div class="hero-image-wrapper">
            <img src={game.img} alt={game.title} />
          </div>
        )
      }
    </section>

    {body && <section class="content-box">{body}</section>}

    {
      !fullDescription && (
        <section class="content-box">
          Denne Simgame er en del af vores sociale golf-univers i The Clubhouse – designet til konkurrencer, højt humør og let tilgængelig simulatorgolf. Spørg personalet efter anbefalinger til netop jeres gruppe, niveau og vibe.
        </section>
      )
    }

    <div class="book-btn">
      <a href="https://www.simgolf.dk/booking" target="_blank" rel="noreferrer"><img src="/book.png" alt="Book knap" /></a>
    </div>
  </main>
</Layout>
